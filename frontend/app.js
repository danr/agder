// Generated by CoffeeScript 1.4.0
(function() {
  var make_url;

  make_url = function(s) {
    return ("http://" + window.location.host) + s;
  };

  angular.module('agder', []).directive('markdown', function() {
    var converter, link;
    converter = new Showdown.converter();
    link = function(scope, element, attrs, model) {
      var render;
      render = function() {
        var htmlText;
        htmlText = converter.makeHtml(model.$modelValue);
        return element.html(htmlText);
      };
      scope.$watch(attrs['ngModel'], render);
      return render();
    };
    return {
      restrict: 'E',
      require: 'ngModel',
      link: link
    };
  }).controller('ProblemsCtrl', function($scope, $http) {
    $scope.problems = [];
    return $http.get(make_url("/problems")).success(function(res) {
      return $scope.problems = res;
    });
  }).controller('ProblemCtrl', function($scope, $http, $location) {
    var $id;
    $id = $scope.id;
    angular.extend($scope, {
      problem: "",
      definitions: "",
      description: "",
      result: "",
      solved: false
    });
    $scope.loc = $location;
    $scope.$watch('loc.search()', function() {
      $scope.show = $location.search()[$id] != null;
      return $scope.updateShow();
    });
    $scope.$watch('show', function() {
      return $location.search($id, $scope.show || null);
    });
    $scope.toggleShow = function() {
      $scope.show = !$scope.show;
      return $scope.updateShow();
    };
    $scope.updateShow = function() {
      if ($scope.show && !$scope.problem) {
        return $http.get(make_url("/problem/" + $id)).success(function(res) {
          $scope.problem = res.problem;
          return $scope.definitions = res.definitions || "";
        });
      }
    };
    return $scope.submit = function() {
      $scope.result = "Submitted!";
      return $http.post(make_url("/solve/" + $id), $scope.problem).success(function(res) {
        $scope.result = res.stdout.replace(RegExp("/home/dan/code/agder/solutions/" + $id + "/[^/]*/([^\\.]*).agda", "g"), function(filename, short) {
          return short + ".agda";
        });
        if (res.exitcode === 0) {
          return $scope.solved = true;
        }
      });
    };
  });

}).call(this);
